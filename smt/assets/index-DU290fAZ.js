import{a as C,j as e}from"./react-CANoef9Z.js";import{c as I}from"./react-dom-CyX_G3Q9.js";import{F as P,a as q,b as X,c as O,d as R,e as D,f as M,g as T,h as B}from"./react-icons-BlASVR7s.js";import{J as U}from"./jszip-BFZwsCO3.js";import{u as F,w as z,r as H}from"./xlsx-oMr0jC9o.js";import"./pizzip-Ft8LAwW4.js";import"./scheduler-SPyfQU6S.js";import"./pako-BxtY3PN3.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=o(s);fetch(s.href,a)}})();const J="/smt/assets/htd-DIJHr3UJ.svg",G=()=>{const[t,r]=C.useState(!1);return e.jsxs("nav",{className:"bg-bk-2 border-b border-bk-3 text-wt-1",role:"navigation","aria-label":"Barra de navegação principal",children:[e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsx(K,{}),e.jsx(V,{className:"hidden md:flex gap-6"}),e.jsx(Q,{open:t,setOpen:r})]}),e.jsx("div",{className:`md:hidden px-4 pt-0 pb-4 transition-all duration-300 ease-in-out ${t?"opacity-100 max-h-96":"opacity-0 max-h-0 overflow-hidden"}`,children:e.jsx(V,{className:"flex flex-col gap-2"})})]})},K=()=>e.jsx("a",{href:"https://autoflux.app.br/",className:"flex items-center gap-2 hover:text-or-1 transition","aria-label":"Ir para o site do AutoFlux",children:e.jsx("div",{className:"h-10 w-auto overflow-hidden flex items-center justify-center text-bk-1 font-bold text-lg select-none",children:e.jsx("img",{src:J,alt:"Logo do AutoFlux",className:"w-full h-full object-contain"})})}),V=({className:t=""})=>e.jsxs("ul",{className:`text-gr-2 font-medium ${t}`,role:"menu",children:[e.jsx("li",{children:e.jsx("a",{href:"https://www.autoflux.app.br",className:"hover:text-or-1 transition-colors duration-150",children:"autoflux"})}),e.jsx("li",{children:e.jsx("a",{href:"https://www.autoflux.app.br/maladireta",className:"hover:text-or-1 transition-colors duration-150",children:"maladireta"})}),e.jsx("li",{children:e.jsx("a",{href:"https://www.vfipe.com.br/",className:"hover:text-or-1 transition-colors duration-150",children:"vfipe"})})]}),Q=({open:t,setOpen:r})=>e.jsx("button",{onClick:()=>r(!t),className:"md:hidden focus:outline-none focus:ring-2 focus:ring-or-2 transition-transform duration-150","aria-label":t?"Fechar menu":"Abrir menu","aria-expanded":t,children:e.jsx("svg",{className:"w-6 h-6 text-wt-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:t?"M6 18L18 6M6 6l12 12":"M4 6h16M4 12h16M4 18h16"})})}),W=()=>e.jsx("footer",{className:"bg-bk-2 border-t border-bk-3 text-wt-2 text-sm px-4 py-4",children:e.jsx("div",{className:"max-w-6xl mx-auto flex flex-col items-center gap-2 text-center sm:flex-row sm:justify-center",children:e.jsxs("p",{className:"text-xs",children:["© ",new Date().getFullYear()," ",e.jsx("span",{className:"font-semibold",children:"autoflux"}),". Todos os direitos reservados."]})})}),Z=()=>e.jsxs("div",{className:"bg-bk-1 p-6 rounded-lg border-l-4 border-or-1 shadow-lg mb-6",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-gradient-orange mb-6",children:"SMT - Formater"}),e.jsx("p",{className:"text-lg leading-relaxed text-wt-2",children:"Transforme sua planilha em um arquivo CSV perfeito para o Sistema de Mensagens Telemáticas dos Correios."}),e.jsxs("div",{className:"mt-4 flex items-center space-x-2 text-sm text-or-1",children:[e.jsx(P,{}),e.jsx("span",{children:"Processamento rápido e sem complicações"})]})]}),Y=()=>{const t=[{title:"Formatação automática",text:"Padronização dos dados conforme requisitos dos Correios."},{title:"Validação avançada",text:"CEPs inválidos são identificados e listados para correção."},{title:"Limite inteligente",text:"Planilhas com mais de 200 registros são automaticamente fracionadas."}];return e.jsxs("div",{className:"bg-bk-1 p-6 rounded-lg border-r-4 border-or-1 shadow-lg mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-wt-1 mb-3 flex items-center gap-2",children:[e.jsx(q,{className:"text-or-1"}),"Main Features"]}),e.jsx("ul",{className:"space-y-3",children:t.map(({title:r,text:o},n)=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-or-1/20 p-1 rounded-full mt-0.5",children:e.jsx(X,{className:"text-or-1 text-xs"})}),e.jsxs("div",{children:[e.jsxs("strong",{className:"text-wt-1",children:[r,":"]}),e.jsxs("span",{className:"text-gr-1",children:[" ",o]})]})]},n))})]})},ee=()=>e.jsxs("a",{href:"docs/template_modelo_smt.xlsx",download:!0,className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-or-2 to-or-3 text-wt-1 rounded-md hover:from-or-2 hover:to-or-4 transition-all duration-200 shadow-md hover:shadow-lg mt-8",children:[e.jsx(D,{}),e.jsx("span",{children:"Baixar Modelo (.XLSX)"})]}),te=({step:t,Icon:r,title:o,text:n,extras:s})=>e.jsxs("div",{className:"flex gap-4 bg-bk-1 p-4 border-bk-3 rounded-lg shadow-xl hover:border-or-1 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 font-bold bg-gradient-to-r from-or-1 to-or-3 text-wt-1",children:t}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-wt-1 mb-1 flex items-center gap-2",children:[r,o]}),e.jsx("p",{className:"text-sm text-gr-1",children:n}),(s==null?void 0:s.length)>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:s.map((a,i)=>e.jsx("span",{className:"text-xs bg-or-1/10 text-or-2 px-2 py-1 rounded-md",children:a},i))}),t==="1"&&e.jsx(ee,{})]})]}),se=()=>{const t=[{step:"1",Icon:e.jsx(D,{className:"text-or-2/60"}),title:"Baixe a planilha modelo",text:"Comece com nosso template pré-formatado contendo todos os campos necessários:",extras:["Nome Completo","CEP","Número"]},{step:"2",Icon:e.jsx(M,{className:"text-or-2/60"}),title:"Preencha os dados",text:"Adicione suas informações. Você pode incluir campos opcionais como:",extras:["Departamento","Código Interno","Telefone"]},{step:"3",Icon:e.jsx(T,{className:"text-or-2/60"}),title:"Envie a planilha",text:"Arraste o arquivo para a área designada ou clique para selecionar. Nosso sistema fará todo o processamento automaticamente.",extras:["Formato suportado: .xlsx"]}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-wt-1 flex items-center gap-2",children:[e.jsx(O,{className:"text-or-1"}),"Como Usar"]}),t.map((r,o)=>e.jsx(te,{...r},o))]})},oe=()=>e.jsx("div",{className:"w-full flex border-t border-gr-3 mt-4",children:e.jsxs("p",{className:"w-full flex justify-center items-center text-gr-2 gap-2 pt-8 text-sm",children:[e.jsx(R,{}),"Em caso de dúvidas",e.jsx("a",{href:"docs/02_Manual_do_Usuário_-_SMT_2.27_-_Telegrama.pdf",className:"text-or-1 hover:underline",children:"consulte o manual."})]})}),ae=()=>e.jsxs("section",{className:"w-full h-[75svh] bg-bk-2 text-wt-1 p-8 rounded-lg shadow-lg flex flex-col gap-6 overflow-scroll",children:[e.jsx(Z,{}),e.jsx(Y,{}),e.jsx(se,{}),e.jsx(oe,{})]}),A={readerXLSX:async o=>{try{const n=await o.arrayBuffer(),s=H(n,{type:"array"}),a=s.SheetNames[0],i=s.Sheets[a],j=s.SheetNames.length,m=F.sheet_to_json(i,{header:1,blankrows:!1});if(m.length===0)return{status:"nok",message:"Planilha não contém dados."};const f=m[0];if(f.length===0)return{status:"nok",message:"Planilha não tem cabeçalho."};const u=F.sheet_to_json(i,{blankrows:!1});return u.length===0?{status:"nok",message:"Planilha contém cabeçalho porém não tem dados."}:{status:"ok",message:"Arquivo processado com sucesso",sheets:j,headers:f,data:u}}catch(n){return{status:"nok",message:`Erro ao processar arquivo. ${n.message}`}}},writeXLSX:(o=[],n="arquivo.xlsx")=>{try{if(!Array.isArray(o)||o.length===0)return{status:"nok",message:"Dados inválidos para exportação",file:null};const s=F.json_to_sheet(o),a=F.book_new();F.book_append_sheet(a,s,"Planilha1");const i=z(a,{bookType:"xlsx",type:"array"}),j=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});return{status:"ok",message:`Arquivo XLSX "${n}" gerado com sucesso.`,file:j}}catch(s){return{status:"nok",message:`Erro ao gerar arquivo XLSX: ${s.message}`,file:null}}}},re=(t,r)=>{if(!t||!t.name)return!1;const o=t.name.toLowerCase(),n=r.toLowerCase();return o.endsWith(n)},_=t=>t==null?"":(t=String(t).trim(),t=t.replace(/\t+/g," "),t=t.replace(/[\r\n]+/g," "),t=Array.from(t).filter(o=>o.charCodeAt(0)>31).join(""),["​","‌","‍","\uFEFF"," "," "].forEach(o=>{t=t.split(o).join("")}),t=t.replace(/\s+/g," "),t.length===0||t===" "?"":t),E=(t,r=!1)=>{typeof t!="string"&&(t=String(t));const o=t.normalize("NFD").replace(/[\u0300-\u036f]/g,"");return r?o.toLowerCase():o},ne=async t=>{const r=async n=>{try{const a=await(await fetch(`https://viacep.com.br/ws/${n}/json/`)).json();return a.erro?{cep:n,valid:!1,error:"CEP não encontrado"}:{cep:n,valid:!0,data:a}}catch(s){return{cep:n,valid:!1,error:s.message}}};return await Promise.all([...t].map(r))},le=async t=>{try{const{status:r,message:o,headers:n,data:s}=await A.readerXLSX(t);if(r==="nok")return{status:r,message:o,dataValid:[],dataInvalid:[]};const a=["titulo/outros","nome completo","e-mail","ddd","telefone","cpf_cnpj","cep","tipo logradouro","logradouro","bairro","cidade","uf","tipo de endereco","complemento","numero"],i=["nome completo","cep","numero"],j={numero:{maxLength:8,numeric:!0},"titulo/outros":{maxLength:40},complemento:{maxLength:40},"nome completo":{maxLength:60},"e-mail":{maxLength:50},"tipo logradouro":{maxLength:72},logradouro:{maxLength:72},bairro:{maxLength:72},cidade:{maxLength:72},uf:{maxLength:2,uppercase:!0},"tipo de endereco":{maxLength:1,allowedValues:["I","N"],defaultValue:"N"},ddd:{maxLength:3,numeric:!0},telefone:{maxLength:10,numeric:!0},cpf_cnpj:{maxLength:14,numeric:!0},cep:{maxLength:8,numeric:!0,padStart:!0}},m=100,f=c=>{const d={...c};for(const l of a)l in d||(d[l]="");return d},u=c=>Object.keys(c).reduce((d,l)=>{if(l==="__rowNum__")return d;const x=E(_(l),!0),p=c[l],v=_(p),L=E(v,!1);return d[x]=L,d},{}),h=c=>{const d=c.map(v=>E(_(v),!0)),l=a.filter(v=>!d.includes(v)),x=d.filter(v=>!a.includes(v)),p=x.filter((v,L)=>x.indexOf(v)!==L);return p.length>0?{missing:l,error:`Colunas extras duplicadas detectadas: ${p.join(", ")}`}:{missing:l,error:null}},g=c=>{const d=[];for(const l of i){const x=c[l];(!x||typeof x=="string"&&x.trim()==="")&&d.push(`Campo obrigatório ausente: ${l}`)}for(const[l,x]of Object.entries(j)){if(!(l in c))continue;let p=String(c[l]??"");if(l==="numero"){const v=p.toLowerCase();if(!v||["s/n","sn"].includes(v)){c.numero="0";const L=c.complemento||"",$=L.toLowerCase().includes("s/n");c.complemento=($?L:`s/n ${L}`).trim().slice(0,j.complemento.maxLength);continue}}if(x.numeric&&(p=p.replace(/\D/g,""),p.length===0&&i.includes(l)&&d.push(`Valor numérico inválido para o campo: ${l}`)),x.uppercase&&(p=p.toUpperCase()),x.allowedValues){const v=p.toUpperCase();p=x.allowedValues.includes(v)?v:x.defaultValue}x.padStart&&(p=p.padStart(x.maxLength,"0")),p=p.slice(0,x.maxLength),c[l]=p,l==="cep"&&p.length!==8&&d.push(`CEP com comprimento inválido: ${p}`)}for(const l of Object.keys(c))!a.includes(l)&&l!=="row"&&!l.startsWith("__")&&String(c[l]??"").length>m&&d.push(`Campo extra "${l}" excede ${m} caracteres`);return d.length===0?null:d},{missing:y,error:S}=h(n);if(y.length>0||S)return{status:"nok",message:[y.length>0?`Colunas obrigatórias ausentes: ${y.join(" | ")}`:null,S].filter(Boolean).join(" | "),dataValid:[],dataInvalid:[]};const w={dataValid:[],dataInvalid:[]};for(const c of s){const d=u(c),l=g(d);if(l){const x=f(d);w.dataInvalid.push({...x,errors:l.join(" | ")})}else w.dataValid.push(d)}const N=[...new Set(w.dataValid.map(c=>c.cep).filter(Boolean))],b=await ne(N),k=b.filter(c=>c.valid===!1).map(c=>c.cep);if(k.length>0){const c=new Set(k);w.dataValid=w.dataValid.filter(d=>{if(c.has(d.cep)){const l=f(d);return w.dataInvalid.push({...l,errors:"CEP inválido"}),!1}return!0})}return{status:"ok",message:`Processadas ${w.dataValid.length} linhas válidas e ${w.dataInvalid.length} inválidas`,...w,ceps:b,REQUIRED_COLUMNS:a}}catch(r){return console.error("Erro no Formater:",r),{status:"nok",message:"Ocorreu um erro inesperado durante o processamento",dataValid:[],dataInvalid:[],ceps:null}}},ie=async(t,r)=>{try{if(!Array.isArray(t))return{status:"nok",message:"Data deve ser um array",csvFiles:[]};if(!Array.isArray(r))return{status:"nok",message:"REQUIRED_COLUMNS deve ser um array",csvFiles:[]};const o=200,n=i=>{const j=r.map(f=>f in i?i[f]:""),m=Object.keys(i).filter(f=>!r.includes(f)).map(f=>`${f}:${i[f]??""}`);return[...j,...m].join(";")},s=t.map(n),a=[];for(let i=0;i<s.length;i+=o){const m=s.slice(i,i+o).join(`
`),f=`dados_validos_parte_${a.length+1}.csv`,u=new Blob([m],{type:"text/csv;charset=utf-8"});a.push({name:f,blob:u})}return{status:"ok",message:`Gerado ${a.length} arquivo(s) CSV`,csvFiles:a}}catch(o){return{status:"nok",message:`Erro ao gerar CSV: ${o.message}`,csvFiles:[]}}},ce=()=>{const[t,r]=C.useState([]),[o,n]=C.useState(!1),[s,a]=C.useState(null),i=(u,h)=>{const g=document.createElement("a");g.href=URL.createObjectURL(u),g.download=h,document.body.appendChild(g),g.click(),document.body.removeChild(g)},j=async u=>{if(!re(u,"xlsx"))return m("⚠️ Arquivo inválido ou inexistente. Selecione um .xlsx válido."),!1;try{n(!0),a(null),r([]);const h=await le(u),{dataValid:g,REQUIRED_COLUMNS:y,dataInvalid:S,message:w}=h,N=[];if(g.length>0){const b=await ie(g,y);b.status==="ok"&&b.csvFiles.length>0&&(b.csvFiles.forEach(({name:k,blob:c})=>{N.push({name:k,blob:c})}),m(`${b.csvFiles.length} arquivo(s) CSV gerado(s).`))}if(S.length>0){const b=A.writeXLSX(S,"dados_invalidos.xlsx");b.status==="ok"&&b.file&&(N.push({name:"dados_invalidos.xlsx",blob:b.file}),m("Arquivo de dados inválidos gerado."))}if(N.length===0)m(`⚠️ ${w}`);else if(N.length===1){const{name:b,blob:k}=N[0];a({blob:k,name:b}),m("Processamento concluído: arquivo único gerado.")}else{const b=await f(N);a({blob:b,name:"resultado_processamento.zip"}),m(`Processamento concluído: ${N.length} arquivos gerados.`)}return!0}catch(h){return m(`❌ Erro ao processar o arquivo: ${h.message||h}`),!1}finally{n(!1)}},m=u=>{r(h=>[...h,{timestamp:new Date,message:u}])},f=async u=>{const h=new U;return u.forEach(({name:g,blob:y})=>h.file(g,y)),await h.generateAsync({type:"blob"})};return{log:t,loading:o,downloadData:s,processFile:j,triggerDownload:i,addLog:m}},de=({onFileChange:t,dragActive:r,onDrag:o})=>{const n=s=>{var a,i;s.preventDefault(),s.stopPropagation(),o(s),(i=(a=s.dataTransfer)==null?void 0:a.files)!=null&&i.length&&t({target:{files:s.dataTransfer.files}})};return e.jsxs("div",{className:"bg-bk-1 p-6 rounded-lg shadow-md",children:[e.jsxs("label",{htmlFor:"xlsx",role:"button","aria-label":"Selecione ou arraste um arquivo",tabIndex:"0",onDrop:n,onDragOver:o,onDragEnter:o,onDragLeave:o,className:`block border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors duration-200
          ${r?"bg-of-green-2/20 border-of-green-3":"border-of-green-4 hover:bg-of-green-2/5"}`,children:[e.jsx(B,{className:"mx-auto text-of-green-4 text-4xl mb-3"}),e.jsx("p",{className:"font-medium",children:"Arraste sua planilha ou clique para enviar"}),e.jsx("p",{className:"text-sm text-gr-1 mt-2",children:"Formato aceito: .xlsx"})]}),e.jsx("input",{id:"xlsx",type:"file",accept:".xlsx",className:"hidden",onChange:t})]})},ue=({logs:t,loading:r})=>r?e.jsx("div",{className:"w-full text-left bg-bk-1 text-gr-2 p-6 rounded-lg shadow-md",children:e.jsx("span",{className:"animate-pulse",children:"⏳ Processando..."})}):e.jsx(e.Fragment,{children:t.length>0&&e.jsx("div",{className:"w-full text-left bg-bk-1 text-gr-2 p-6 rounded-lg shadow-md",children:t.slice().reverse().map((o,n)=>e.jsxs("p",{children:[e.jsxs("span",{className:"text-gr-1 text-xs mr-2",children:["[",o.timestamp.toLocaleTimeString(),"]"]}),o.message]},n))})}),me=({onClick:t})=>e.jsx("div",{className:"w-full text-center",children:e.jsx("button",{onClick:t,className:"mt-4 px-6 py-2 bg-of-green-4 text-white rounded hover:bg-of-green-3 transition",children:"Baixar resultados"})}),xe=()=>{const[t,r]=C.useState(!1),{log:o,loading:n,downloadData:s,processFile:a,triggerDownload:i}=ce(),j=async u=>{var g;const h=(g=u.target.files)==null?void 0:g[0];h&&await a(h)},m=u=>{u.preventDefault(),u.stopPropagation(),r(u.type==="dragenter"||u.type==="dragover")},f=()=>{s&&i(s.blob,s.name)};return e.jsxs("section",{className:"w-full h-[75svh] bg-bk-2 text-wt-1 p-8 rounded-lg shadow-lg flex flex-col gap-6 overflow-scroll",children:[e.jsx(de,{onFileChange:j,onDrag:m,dragActive:t}),e.jsx(ue,{logs:o,loading:n}),s&&e.jsx(me,{onClick:f})]})},pe=()=>e.jsxs("main",{className:"h-[100svh] bg-bk-1 text-wt-1 font-sans flex flex-col",children:[e.jsx(G,{}),e.jsxs("div",{className:`h-[100%] overflow-y-auto overflow-x-hidden
          grid gap-4 p-4
          justify-center items-center
          lg:grid-cols-2`,children:[e.jsx(ae,{}),e.jsx(xe,{})]}),e.jsx(W,{})]});I.createRoot(document.getElementById("root")).render(e.jsx(C.StrictMode,{children:e.jsx(pe,{})}));
