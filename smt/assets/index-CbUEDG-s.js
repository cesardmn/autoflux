import{a as C,j as e}from"./react-CANoef9Z.js";import{c as I}from"./react-dom-CyX_G3Q9.js";import{F as P,a as O,b as R,c as X,d as q,e as A,f as M,g as T,h as U}from"./react-icons-BlASVR7s.js";import{J as B}from"./jszip-BFZwsCO3.js";import{u as F,w as z,r as H}from"./xlsx-oMr0jC9o.js";import"./pizzip-Ft8LAwW4.js";import"./scheduler-SPyfQU6S.js";import"./pako-BxtY3PN3.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function o(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=o(s);fetch(s.href,a)}})();const J="/smt/assets/htd-DIJHr3UJ.svg",Q=()=>{const[t,r]=C.useState(!1);return e.jsxs("nav",{className:"bg-bk-2 border-b border-bk-3 text-wt-1",role:"navigation","aria-label":"Barra de navegação principal",children:[e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsx(G,{}),e.jsx(D,{className:"hidden md:flex gap-6"}),e.jsx(K,{open:t,setOpen:r})]}),e.jsx("div",{className:`md:hidden px-4 pt-0 pb-4 transition-all duration-300 ease-in-out ${t?"opacity-100 max-h-96":"opacity-0 max-h-0 overflow-hidden"}`,children:e.jsx(D,{className:"flex flex-col gap-2"})})]})},G=()=>e.jsx("a",{href:"https://autoflux.app.br/",className:"flex items-center gap-2 hover:text-or-1 transition","aria-label":"Ir para o site do AutoFlux",children:e.jsx("div",{className:"h-10 w-auto overflow-hidden flex items-center justify-center text-bk-1 font-bold text-lg select-none",children:e.jsx("img",{src:J,alt:"Logo do AutoFlux",className:"w-full h-full object-contain"})})}),D=({className:t=""})=>e.jsxs("ul",{className:`text-gr-2 font-medium ${t}`,role:"menu",children:[e.jsx("li",{children:e.jsx("a",{href:"https://www.autoflux.app.br",className:"hover:text-or-1 transition-colors duration-150",children:"autoflux"})}),e.jsx("li",{children:e.jsx("a",{href:"https://www.autoflux.app.br/maladireta",className:"hover:text-or-1 transition-colors duration-150",children:"maladireta"})}),e.jsx("li",{children:e.jsx("a",{href:"https://www.vfipe.com.br/",className:"hover:text-or-1 transition-colors duration-150",children:"vfipe"})})]}),K=({open:t,setOpen:r})=>e.jsx("button",{onClick:()=>r(!t),className:"md:hidden focus:outline-none focus:ring-2 focus:ring-or-2 transition-transform duration-150","aria-label":t?"Fechar menu":"Abrir menu","aria-expanded":t,children:e.jsx("svg",{className:"w-6 h-6 text-wt-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:t?"M6 18L18 6M6 6l12 12":"M4 6h16M4 12h16M4 18h16"})})}),W=()=>e.jsx("footer",{className:"bg-bk-2 border-t border-bk-3 text-wt-2 text-sm px-4 py-4",children:e.jsx("div",{className:"max-w-6xl mx-auto flex flex-col items-center gap-2 text-center sm:flex-row sm:justify-center",children:e.jsxs("p",{className:"text-xs",children:["© ",new Date().getFullYear()," ",e.jsx("span",{className:"font-semibold",children:"autoflux"}),". Todos os direitos reservados."]})})}),Z=()=>e.jsxs("div",{className:"bg-bk-1 p-6 rounded-lg border-l-4 border-or-1 shadow-lg mb-6",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-gradient-orange mb-6",children:"SMT - Formater"}),e.jsx("p",{className:"text-lg leading-relaxed text-wt-2",children:"Transforme sua planilha em um arquivo CSV perfeito para o Sistema de Mensagens Telemáticas dos Correios."}),e.jsxs("div",{className:"mt-4 flex items-center space-x-2 text-sm text-or-1",children:[e.jsx(P,{}),e.jsx("span",{children:"Processamento rápido e sem complicações"})]})]}),Y=()=>{const t=[{title:"Formatação automática",text:"Padronização dos dados conforme requisitos dos Correios."},{title:"Validação avançada",text:"CEPs inválidos são identificados e listados para correção."},{title:"Limite inteligente",text:"Planilhas com mais de 200 registros são automaticamente fracionadas."}];return e.jsxs("div",{className:"bg-bk-1 p-6 rounded-lg border-r-4 border-or-1 shadow-lg mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-wt-1 mb-3 flex items-center gap-2",children:[e.jsx(O,{className:"text-or-1"}),"Main Features"]}),e.jsx("ul",{className:"space-y-3",children:t.map(({title:r,text:o},n)=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"bg-or-1/20 p-1 rounded-full mt-0.5",children:e.jsx(R,{className:"text-or-1 text-xs"})}),e.jsxs("div",{children:[e.jsxs("strong",{className:"text-wt-1",children:[r,":"]}),e.jsxs("span",{className:"text-gr-1",children:[" ",o]})]})]},n))})]})},ee=()=>e.jsxs("a",{href:"docs/template_modelo_smt.xlsx",download:!0,className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-or-2 to-or-3 text-wt-1 rounded-md hover:from-or-2 hover:to-or-4 transition-all duration-200 shadow-md hover:shadow-lg mt-8",children:[e.jsx(A,{}),e.jsx("span",{children:"Baixar Modelo (.XLSX)"})]}),te=({step:t,Icon:r,title:o,text:n,extras:s})=>e.jsxs("div",{className:"flex gap-4 bg-bk-1 p-4 border-bk-3 rounded-lg shadow-xl hover:border-or-1 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 font-bold bg-gradient-to-r from-or-1 to-or-3 text-wt-1",children:t}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-wt-1 mb-1 flex items-center gap-2",children:[r,o]}),e.jsx("p",{className:"text-sm text-gr-1",children:n}),(s==null?void 0:s.length)>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:s.map((a,c)=>e.jsx("span",{className:"text-xs bg-or-1/10 text-or-2 px-2 py-1 rounded-md",children:a},c))}),t==="1"&&e.jsx(ee,{})]})]}),se=()=>{const t=[{step:"1",Icon:e.jsx(A,{className:"text-or-2/60"}),title:"Baixe a planilha modelo",text:"Comece com nosso template pré-formatado contendo todos os campos necessários:",extras:["Nome Completo","CEP","Número"]},{step:"2",Icon:e.jsx(M,{className:"text-or-2/60"}),title:"Preencha os dados",text:"Adicione suas informações. Você pode incluir campos opcionais como:",extras:["Departamento","Código Interno","Telefone"]},{step:"3",Icon:e.jsx(T,{className:"text-or-2/60"}),title:"Envie a planilha",text:"Arraste o arquivo para a área designada ou clique para selecionar. Nosso sistema fará todo o processamento automaticamente.",extras:["Formato suportado: .xlsx"]}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-wt-1 flex items-center gap-2",children:[e.jsx(X,{className:"text-or-1"}),"Como Usar"]}),t.map((r,o)=>e.jsx(te,{...r},o))]})},oe=()=>e.jsx("div",{className:"w-full flex border-t border-gr-3 mt-4",children:e.jsxs("p",{className:"w-full flex justify-center items-center text-gr-2 gap-2 pt-8 text-sm",children:[e.jsx(q,{}),"Em caso de dúvidas",e.jsx("a",{href:"docs/02_Manual_do_Usuário_-_SMT_2.27_-_Telegrama.pdf",className:"text-or-1 hover:underline",children:"consulte o manual."})]})}),ae=()=>e.jsxs("section",{className:"w-full h-[75svh] bg-bk-2 text-wt-1 p-8 rounded-lg shadow-lg flex flex-col gap-6 overflow-scroll",children:[e.jsx(Z,{}),e.jsx(Y,{}),e.jsx(se,{}),e.jsx(oe,{})]}),V={readerXLSX:async o=>{try{const n=await o.arrayBuffer(),s=H(n,{type:"array"}),a=s.SheetNames[0],c=s.Sheets[a],v=s.SheetNames.length,u=F.sheet_to_json(c,{header:1,blankrows:!1});if(u.length===0)return{status:"nok",message:"Planilha não contém dados."};const j=u[0];if(j.length===0)return{status:"nok",message:"Planilha não tem cabeçalho."};const m=F.sheet_to_json(c,{blankrows:!1});return m.length===0?{status:"nok",message:"Planilha contém cabeçalho porém não tem dados."}:{status:"ok",message:"Arquivo processado com sucesso",sheets:v,headers:j,data:m}}catch(n){return{status:"nok",message:`Erro ao processar arquivo. ${n.message}`}}},writeXLSX:(o=[],n="arquivo.xlsx")=>{try{if(!Array.isArray(o)||o.length===0)return{status:"nok",message:"Dados inválidos para exportação",file:null};const s=F.json_to_sheet(o),a=F.book_new();F.book_append_sheet(a,s,"Planilha1");const c=z(a,{bookType:"xlsx",type:"array"}),v=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});return{status:"ok",message:`Arquivo XLSX "${n}" gerado com sucesso.`,file:v}}catch(s){return{status:"nok",message:`Erro ao gerar arquivo XLSX: ${s.message}`,file:null}}}},re=(t,r)=>{if(!t||!t.name)return!1;const o=t.name.toLowerCase(),n=r.toLowerCase();return o.endsWith(n)},_=t=>t==null?"":(t=String(t).trim(),t=t.replace(/\t+/g," "),t=t.replace(/[\r\n]+/g," "),t=Array.from(t).filter(o=>o.charCodeAt(0)>31).join(""),["​","‌","‍","\uFEFF"," "," "].forEach(o=>{t=t.split(o).join("")}),t=t.replace(/\s+/g," "),t.length===0||t===" "?"":t),E=(t,r=!1)=>{typeof t!="string"&&(t=String(t));const o=t.normalize("NFD").replace(/[\u0300-\u036f]/g,"");return r?o.toLowerCase():o},ne=async t=>{const r=async n=>{try{const a=await(await fetch(`https://viacep.com.br/ws/${n}/json/`)).json();return a.erro?{cep:n,valid:!1,error:"CEP não encontrado"}:{cep:n,valid:!0,data:a}}catch(s){return{cep:n,valid:!1,error:s.message}}};return await Promise.all([...t].map(r))},le=async t=>{try{const{status:r,message:o,headers:n,data:s}=await V.readerXLSX(t);if(r==="nok")return{status:r,message:o,dataValid:[],dataInvalid:[]};const a=["titulo/outros","nome completo","e-mail","ddd","telefone","cpf_cnpj","cep","tipo logradouro","logradouro","bairro","cidade","uf","tipo de endereco","complemento","numero"],c=["nome completo","cep","numero"],v={numero:{maxLength:8,numeric:!0},"titulo/outros":{maxLength:40},complemento:{maxLength:40},"nome completo":{maxLength:60},"e-mail":{maxLength:50},"tipo logradouro":{maxLength:72},logradouro:{maxLength:72},bairro:{maxLength:72},cidade:{maxLength:72},uf:{maxLength:2,uppercase:!0},"tipo de endereco":{maxLength:1,allowedValues:["I","N"],defaultValue:"N"},ddd:{maxLength:3,numeric:!0},telefone:{maxLength:10,numeric:!0},cpf_cnpj:{maxLength:14,numeric:!0},cep:{maxLength:8,numeric:!0,padStart:!0}},u=100,j=i=>{const d={...i};for(const l of a)l in d||(d[l]="");return d},m=i=>Object.keys(i).reduce((d,l)=>{if(l==="__rowNum__")return d;const x=E(_(l),!0),p=i[l],b=_(p),L=E(b,!1);return d[x]=L,d},{}),f=i=>{const d=i.map(b=>E(_(b),!0)),l=a.filter(b=>!d.includes(b)),x=d.filter(b=>!a.includes(b)),p=x.filter((b,L)=>x.indexOf(b)!==L);return p.length>0?{missing:l,error:`Colunas extras duplicadas detectadas: ${p.join(", ")}`}:{missing:l,error:null}},h=i=>{const d=[];for(const l of c){const x=i[l];(!x||typeof x=="string"&&x.trim()==="")&&d.push(`Campo obrigatório ausente: ${l}`)}for(const[l,x]of Object.entries(v)){if(!(l in i))continue;let p=String(i[l]??"");if(l==="numero"){const b=p.toLowerCase();if(!b||["s/n","sn"].includes(b)){i.numero="0";const L=i.complemento||"",$=L.toLowerCase().includes("s/n");i.complemento=($?L:`s/n ${L}`).trim().slice(0,v.complemento.maxLength);continue}}if(x.numeric&&(p=p.replace(/\D/g,""),p.length===0&&c.includes(l)&&d.push(`Valor numérico inválido para o campo: ${l}`)),x.uppercase&&(p=p.toUpperCase()),x.allowedValues){const b=p.toUpperCase();p=x.allowedValues.includes(b)?b:x.defaultValue}x.padStart&&(p=p.padStart(x.maxLength,"0")),p=p.slice(0,x.maxLength),i[l]=p,l==="cep"&&p.length!==8&&d.push(`CEP com comprimento inválido: ${p}`)}for(const l of Object.keys(i))!a.includes(l)&&l!=="row"&&!l.startsWith("__")&&String(i[l]??"").length>u&&d.push(`Campo extra "${l}" excede ${u} caracteres`);return d.length===0?null:d},{missing:y,error:S}=f(n);if(y.length>0||S)return{status:"nok",message:[y.length>0?`Colunas obrigatórias ausentes: ${y.join(" | ")}`:null,S].filter(Boolean).join(" | "),dataValid:[],dataInvalid:[]};const w={dataValid:[],dataInvalid:[]};for(const i of s){const d=m(i),l=h(d);if(l){const x=j(d);w.dataInvalid.push({...x,errors:l.join(" | ")})}else w.dataValid.push(d)}const N=[...new Set(w.dataValid.map(i=>i.cep).filter(Boolean))],g=await ne(N),k=g.filter(i=>i.valid===!1).map(i=>i.cep);if(k.length>0){const i=new Set(k);w.dataValid=w.dataValid.filter(d=>{if(i.has(d.cep)){const l=j(d);return w.dataInvalid.push({...l,errors:"CEP inválido"}),!1}return!0})}return{status:"ok",message:`Processadas ${w.dataValid.length} linhas válidas e ${w.dataInvalid.length} inválidas`,...w,ceps:g,REQUIRED_COLUMNS:a}}catch(r){return console.error("Erro no Formater:",r),{status:"nok",message:"Ocorreu um erro inesperado durante o processamento",dataValid:[],dataInvalid:[],ceps:null}}},ie=async(t,r)=>{try{if(!Array.isArray(t))return{status:"nok",message:"Data deve ser um array",csvFiles:[]};if(!Array.isArray(r))return{status:"nok",message:"REQUIRED_COLUMNS deve ser um array",csvFiles:[]};const o=200,n=c=>Object.entries(c).map(([v,u])=>r.includes(v)?`${u}`:`${v}:${u}`).join(";"),s=t.map(n),a=[];for(let c=0;c<s.length;c+=o){const u=s.slice(c,c+o).join(`
`),j=`dados_validos_parte_${a.length+1}.csv`,m=new Blob([u],{type:"text/csv"});a.push({name:j,blob:m})}return{status:"ok",message:`Gerado ${a.length} arquivo(s) CSV`,csvFiles:a}}catch(o){return{status:"nok",message:`Erro ao gerar CSV: ${o.message}`,csvFiles:[]}}},ce=()=>{const[t,r]=C.useState([]),[o,n]=C.useState(!1),[s,a]=C.useState(null),c=(m,f)=>{const h=document.createElement("a");h.href=URL.createObjectURL(m),h.download=f,document.body.appendChild(h),h.click(),document.body.removeChild(h)},v=async m=>{if(!re(m,"xlsx"))return u("⚠️ Arquivo inválido ou inexistente. Selecione um .xlsx válido."),!1;try{n(!0),a(null),r([]);const f=await le(m),{dataValid:h,REQUIRED_COLUMNS:y,dataInvalid:S,message:w}=f,N=[];if(h.length>0){const g=await ie(h,y);g.status==="ok"&&g.csvFiles.length>0&&(g.csvFiles.forEach(({name:k,blob:i})=>{N.push({name:k,blob:i})}),u(`${g.csvFiles.length} arquivo(s) CSV gerado(s).`))}if(S.length>0){const g=V.writeXLSX(S,"dados_invalidos.xlsx");g.status==="ok"&&g.file&&(N.push({name:"dados_invalidos.xlsx",blob:g.file}),u("Arquivo de dados inválidos gerado."))}if(N.length===0)u(`⚠️ ${w}`);else if(N.length===1){const{name:g,blob:k}=N[0];a({blob:k,name:g}),u("Processamento concluído: arquivo único gerado.")}else{const g=await j(N);a({blob:g,name:"resultado_processamento.zip"}),u(`Processamento concluído: ${N.length} arquivos gerados.`)}return!0}catch(f){return u(`❌ Erro ao processar o arquivo: ${f.message||f}`),!1}finally{n(!1)}},u=m=>{r(f=>[...f,{timestamp:new Date,message:m}])},j=async m=>{const f=new B;return m.forEach(({name:h,blob:y})=>f.file(h,y)),await f.generateAsync({type:"blob"})};return{log:t,loading:o,downloadData:s,processFile:v,triggerDownload:c,addLog:u}},de=({onFileChange:t,dragActive:r,onDrag:o})=>{const n=s=>{var a,c;s.preventDefault(),s.stopPropagation(),o(s),(c=(a=s.dataTransfer)==null?void 0:a.files)!=null&&c.length&&t({target:{files:s.dataTransfer.files}})};return e.jsxs("div",{className:"bg-bk-1 p-6 rounded-lg shadow-md",children:[e.jsxs("label",{htmlFor:"xlsx",role:"button","aria-label":"Selecione ou arraste um arquivo",tabIndex:"0",onDrop:n,onDragOver:o,onDragEnter:o,onDragLeave:o,className:`block border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors duration-200
          ${r?"bg-of-green-2/20 border-of-green-3":"border-of-green-4 hover:bg-of-green-2/5"}`,children:[e.jsx(U,{className:"mx-auto text-of-green-4 text-4xl mb-3"}),e.jsx("p",{className:"font-medium",children:"Arraste sua planilha ou clique para enviar"}),e.jsx("p",{className:"text-sm text-gr-1 mt-2",children:"Formato aceito: .xlsx"})]}),e.jsx("input",{id:"xlsx",type:"file",accept:".xlsx",className:"hidden",onChange:t})]})},me=({logs:t,loading:r})=>r?e.jsx("div",{className:"w-full text-left bg-bk-1 text-gr-2 p-6 rounded-lg shadow-md",children:e.jsx("span",{className:"animate-pulse",children:"⏳ Processando..."})}):e.jsx(e.Fragment,{children:t.length>0&&e.jsx("div",{className:"w-full text-left bg-bk-1 text-gr-2 p-6 rounded-lg shadow-md",children:t.slice().reverse().map((o,n)=>e.jsxs("p",{children:[e.jsxs("span",{className:"text-gr-1 text-xs mr-2",children:["[",o.timestamp.toLocaleTimeString(),"]"]}),o.message]},n))})}),ue=({onClick:t})=>e.jsx("div",{className:"w-full text-center",children:e.jsx("button",{onClick:t,className:"mt-4 px-6 py-2 bg-of-green-4 text-white rounded hover:bg-of-green-3 transition",children:"Baixar resultados"})}),xe=()=>{const[t,r]=C.useState(!1),{log:o,loading:n,downloadData:s,processFile:a,triggerDownload:c}=ce(),v=async m=>{var h;const f=(h=m.target.files)==null?void 0:h[0];f&&await a(f)},u=m=>{m.preventDefault(),m.stopPropagation(),r(m.type==="dragenter"||m.type==="dragover")},j=()=>{s&&c(s.blob,s.name)};return e.jsxs("section",{className:"w-full h-[75svh] bg-bk-2 text-wt-1 p-8 rounded-lg shadow-lg flex flex-col gap-6 overflow-scroll",children:[e.jsx(de,{onFileChange:v,onDrag:u,dragActive:t}),e.jsx(me,{logs:o,loading:n}),s&&e.jsx(ue,{onClick:j})]})},pe=()=>e.jsxs("main",{className:"h-[100svh] bg-bk-1 text-wt-1 font-sans flex flex-col",children:[e.jsx(Q,{}),e.jsxs("div",{className:`h-[100%] overflow-y-auto overflow-x-hidden
          grid gap-4 p-4
          justify-center items-center
          lg:grid-cols-2`,children:[e.jsx(ae,{}),e.jsx(xe,{})]}),e.jsx(W,{})]});I.createRoot(document.getElementById("root")).render(e.jsx(C.StrictMode,{children:e.jsx(pe,{})}));
