import{r as Z}from"./underscore-D8pyYJcL.js";import{r as rr}from"./option-De8OoYKj.js";var k={},R={},S={exports:{}},P;function er(){if(P)return S.exports;P=1;var r=S.exports=function(t,s){this._tokens=t,this._startIndex=s||0};return r.prototype.head=function(){return this._tokens[this._startIndex]},r.prototype.tail=function(t){return new r(this._tokens,this._startIndex+1)},r.prototype.toArray=function(){return this._tokens.slice(this._startIndex)},r.prototype.end=function(){return this._tokens[this._tokens.length-1]},r.prototype.to=function(t){var s=this.head().source,a=t.head()||t.end();return s.to(a.source)},S.exports}var V;function tr(){if(V)return R;V=1;var r=er();return R.Parser=function(t){var s=function(a,m){return a(new r(m))};return{parseTokens:s}},R}var b={},I,F;function L(){if(F)return I;F=1,I={failure:function(t,s){if(t.length<1)throw new Error("Failure must have errors");return new r({status:"failure",remaining:s,errors:t})},error:function(t,s){if(t.length<1)throw new Error("Failure must have errors");return new r({status:"error",remaining:s,errors:t})},success:function(t,s,a){return new r({status:"success",value:t,source:a,remaining:s,errors:[]})},cut:function(t){return new r({status:"cut",remaining:t,errors:[]})}};var r=function(t){this._value=t.value,this._status=t.status,this._hasValue=t.value!==void 0,this._remaining=t.remaining,this._source=t.source,this._errors=t.errors};return r.prototype.map=function(t){return this._hasValue?new r({value:t(this._value,this._source),status:this._status,remaining:this._remaining,source:this._source,errors:this._errors}):this},r.prototype.changeRemaining=function(t){return new r({value:this._value,status:this._status,remaining:t,source:this._source,errors:this._errors})},r.prototype.isSuccess=function(){return this._status==="success"||this._status==="cut"},r.prototype.isFailure=function(){return this._status==="failure"},r.prototype.isError=function(){return this._status==="error"},r.prototype.isCut=function(){return this._status==="cut"},r.prototype.value=function(){return this._value},r.prototype.remaining=function(){return this._remaining},r.prototype.source=function(){return this._source},r.prototype.errors=function(){return this._errors},I}var T={},U;function J(){if(U)return T;U=1,T.error=function(t){return new r(t)};var r=function(t){this.expected=t.expected,this.actual=t.actual,this._location=t.location};return r.prototype.describe=function(){var t=this._location?this._location.describe()+`:
`:"";return t+"Expected "+this.expected+`
but got `+this.actual},r.prototype.lineNumber=function(){return this._location.lineNumber()},r.prototype.characterNumber=function(){return this._location.characterNumber()},T}var A={},W;function nr(){if(W)return A;W=1,A.fromArray=function(t){var s=0,a=function(){return s<t.length};return new r({hasNext:a,next:function(){if(a())return t[s++];throw new Error("No more elements")}})};var r=function(t){this._iterator=t};return r.prototype.map=function(t){var s=this._iterator;return new r({hasNext:function(){return s.hasNext()},next:function(){return t(s.next())}})},r.prototype.filter=function(t){var s=this._iterator,a=!1,m=!1,f,p=function(){if(!a)for(a=!0,m=!1;s.hasNext()&&!m;)f=s.next(),m=t(f)};return new r({hasNext:function(){return p(),m},next:function(){p();var c=f;return a=!1,c}})},r.prototype.first=function(){var t=this._iterator;return this._iterator.hasNext()?t.next():null},r.prototype.toArray=function(){for(var t=[];this._iterator.hasNext();)t.push(this._iterator.next());return t},A}var $;function K(){return $||($=1,function(r){var t=Z,s=rr(),a=L(),m=J(),f=nr();r.token=function(e,n){var i=n!==void 0;return function(u){var l=u.head();if(l&&l.name===e&&(!i||l.value===n))return a.success(l.value,u.tail(),l.source);var v=g({name:e,value:n});return o(u,v)}},r.tokenOfType=function(e){return r.token(e)},r.firstOf=function(e,n){return t.isArray(n)||(n=Array.prototype.slice.call(arguments,1)),function(i){return f.fromArray(n).map(function(u){return u(i)}).filter(function(u){return u.isSuccess()||u.isError()}).first()||o(i,e)}},r.then=function(e,n){return function(i){var u=e(i);return u.map||console.log(u),u.map(n)}},r.sequence=function(){var e=Array.prototype.slice.call(arguments,0),n=function(u){var l=t.foldl(e,function(w,d){var y=w.result,N=w.hasCut;if(!y.isSuccess())return{result:y,hasCut:N};var x=d(y.remaining());if(x.isCut())return{result:y,hasCut:!0};if(x.isSuccess()){var q;d.isCaptured?q=y.value().withValue(d,x.value()):q=y.value();var M=x.remaining(),Y=u.to(M);return{result:a.success(q,M,Y),hasCut:N}}else return N?{result:a.error(x.errors(),x.remaining()),hasCut:N}:{result:x,hasCut:N}},{result:a.success(new p,u),hasCut:!1}).result,v=u.to(l.remaining());return l.map(function(w){return w.withValue(r.sequence.source,v)})};n.head=function(){var u=t.find(e,i);return r.then(n,r.sequence.extract(u))},n.map=function(u){return r.then(n,function(l){return u.apply(this,l.toArray())})};function i(u){return u.isCaptured}return n};var p=function(e,n){this._values=e||{},this._valuesArray=n||[]};p.prototype.withValue=function(e,n){if(e.captureName&&e.captureName in this._values)throw new Error('Cannot add second value for capture "'+e.captureName+'"');var i=t.clone(this._values);i[e.captureName]=n;var u=this._valuesArray.concat([n]);return new p(i,u)},p.prototype.get=function(e){if(e.captureName in this._values)return this._values[e.captureName];throw new Error('No value for capture "'+e.captureName+'"')},p.prototype.toArray=function(){return this._valuesArray},r.sequence.capture=function(e,n){var i=function(){return e.apply(this,arguments)};return i.captureName=n,i.isCaptured=!0,i},r.sequence.extract=function(e){return function(n){return n.get(e)}},r.sequence.applyValues=function(e){var n=Array.prototype.slice.call(arguments,1);return function(i){var u=n.map(function(l){return i.get(l)});return e.apply(this,u)}},r.sequence.source={captureName:"☃source☃"},r.sequence.cut=function(){return function(e){return a.cut(e)}},r.optional=function(e){return function(n){var i=e(n);return i.isSuccess()?i.map(s.some):i.isFailure()?a.success(s.none,n):i}},r.zeroOrMoreWithSeparator=function(e,n){return _(e,n,!1)},r.oneOrMoreWithSeparator=function(e,n){return _(e,n,!0)};var c=r.zeroOrMore=function(e){return function(n){for(var i=[],u;(u=e(n))&&u.isSuccess();)n=u.remaining(),i.push(u.value());return u.isError()?u:a.success(i,n)}};r.oneOrMore=function(e){return r.oneOrMoreWithSeparator(e,h)};function h(e){return a.success(null,e)}var _=function(e,n,i){return function(u){var l=e(u);if(l.isSuccess()){var v=r.sequence.capture(e,"main"),w=c(r.then(r.sequence(n,v),r.sequence.extract(v))),d=w(l.remaining());return a.success([l.value()].concat(d.value()),d.remaining())}else return i||l.isError()?l:a.success([],u)}};r.leftAssociative=function(e,n,i){var u;i?u=[{func:i,rule:n}]:u=n,u=u.map(function(v){return r.then(v.rule,function(w){return function(d,y){return v.func(d,w,y)}})});var l=r.firstOf.apply(null,["rules"].concat(u));return function(v){var w=v,d=e(v);if(!d.isSuccess())return d;for(var y=l(d.remaining());y.isSuccess();){var N=y.remaining(),x=w.to(y.remaining()),q=y.value();d=a.success(q(d.value(),x),N,x),y=l(d.remaining())}return y.isError()?y:d}},r.leftAssociative.firstOf=function(){return Array.prototype.slice.call(arguments,0)},r.nonConsuming=function(e){return function(n){return e(n).changeRemaining(n)}};var g=function(e){return e.value?e.name+' "'+e.value+'"':e.name};function o(e,n){var i,u=e.head();return u?i=m.error({expected:n,actual:g(u),location:u.source}):i=m.error({expected:n,actual:"end of tokens"}),a.failure([i],e)}}(b)),b}var C={exports:{}},B;function Q(){if(B)return C.exports;B=1,C.exports=function(t,s){var a={asString:function(){return t},range:function(m,f){return new r(t,s,m,f)}};return a};var r=function(t,s,a,m){this._string=t,this._description=s,this._startIndex=a,this._endIndex=m};return r.prototype.to=function(t){return new r(this._string,this._description,this._startIndex,t._endIndex)},r.prototype.describe=function(){var t=this._position(),s=this._description?this._description+`
`:"";return s+"Line number: "+t.lineNumber+`
Character number: `+t.characterNumber},r.prototype.lineNumber=function(){return this._position().lineNumber},r.prototype.characterNumber=function(){return this._position().characterNumber},r.prototype._position=function(){for(var t=this,s=0,a=function(){return t._string.indexOf(`
`,s)},m=1;a()!==-1&&a()<this._startIndex;)s=a()+1,m+=1;var f=this._startIndex-s+1;return{lineNumber:m,characterNumber:f}},C.exports}var E,D;function X(){return D||(D=1,E=function(r,t,s){this.name=r,this.value=t,s&&(this.source=s)}),E}var O={},j;function ur(){return j||(j=1,function(r){var t=K(),s=L();r.parser=function(f,p,c){var h={rule:e,leftAssociative:n,rightAssociative:i},_=new a(c.map(o)),g=t.firstOf(f,p);function o(v){return{name:v.name,rule:m(v.ruleBuilder.bind(null,h))}}function e(){return u(_)}function n(v){return u(_.untilExclusive(v))}function i(v){return u(_.untilInclusive(v))}function u(v){return l.bind(null,v)}function l(v,w){var d=g(w);return d.isSuccess()?v.apply(d):d}return h};function a(f){function p(o){return new a(f.slice(0,h().indexOf(o)))}function c(o){return new a(f.slice(0,h().indexOf(o)+1))}function h(){return f.map(function(o){return o.name})}function _(o){for(var e,n;;)if(e=g(o.remaining()),e.isSuccess())n=o.source().to(e.source()),o=s.success(e.value()(o.value(),n),e.remaining(),n);else return e.isFailure()?o:e}function g(o){return t.firstOf("infix",f.map(function(e){return e.rule}))(o)}return{apply:_,untilExclusive:p,untilInclusive:c}}r.infix=function(f,p){function c(h){return r.infix(f,function(_){var g=p(_);return function(o){var e=g(o);return e.map(function(n){return function(i,u){return h(i,n,u)}})}})}return{name:f,ruleBuilder:p,map:c}};var m=function(f){var p;return function(c){return p||(p=f()),p(c)}}}(O)),O}var z={},G;function ir(){if(G)return z;G=1;var r=X(),t=Q();z.RegexTokeniser=s;function s(a){a=a.map(function(c){return{name:c.name,regex:new RegExp(c.regex.source,"g")}});function m(c,h){for(var _=new t(c,h),g=0,o=[];g<c.length;){var e=f(c,g,_);g=e.endIndex,o.push(e.token)}return o.push(p(c,_)),o}function f(c,h,_){for(var g=0;g<a.length;g++){var o=a[g].regex;o.lastIndex=h;var e=o.exec(c);if(e){var i=h+e[0].length;if(e.index===h&&i>h){var n=e[1],u=new r(a[g].name,n,_.range(h,i));return{token:u,endIndex:i}}}}var i=h+1,u=new r("unrecognisedCharacter",c.substring(h,i),_.range(h,i));return{token:u,endIndex:i}}function p(c,h){return new r("end",null,h.range(c.length,c.length))}return{tokenise:m}}return z}var H;function or(){return H||(H=1,k.Parser=tr().Parser,k.rules=K(),k.errors=J(),k.results=L(),k.StringSource=Q(),k.Token=X(),k.bottomUp=ur(),k.RegexTokeniser=ir().RegexTokeniser,k.rule=function(r){var t;return function(s){return t||(t=r()),t(s)}}),k}export{or as r};
